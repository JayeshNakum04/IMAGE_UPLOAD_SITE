<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Secure Photo Upload</title>

<style>
* {
    box-sizing: border-box;
}

body {
    margin: 0;
    min-height: 100vh;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #4facfe);
    background-size: 400% 400%;
    animation: bg 15s ease infinite;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    padding: 20px;
}

@keyframes bg {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.container {
    width: 95%;
    max-width: 520px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    padding: 35px;
    border-radius: 24px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.2);
    animation: slideIn 0.6s ease;
}

h2 {
    margin: 0 0 25px 0;
    font-size: 28px;
    font-weight: 600;
    text-align: center;
    background: linear-gradient(135deg, #fff, #f0f0f0);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.upload-box {
    border: 2px dashed rgba(255, 255, 255, 0.4);
    padding: 40px 20px;
    text-align: center;
    border-radius: 16px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.05);
    position: relative;
}

.upload-box:hover {
    border-color: rgba(255, 255, 255, 0.8);
    background: rgba(255, 255, 255, 0.1);
    transform: translateY(-2px);
}

.upload-icon {
    font-size: 48px;
    margin-bottom: 10px;
}

.upload-text {
    font-size: 16px;
    color: rgba(255, 255, 255, 0.9);
}

input[type="file"] {
    display: none;
}

button {
    width: 100%;
    margin-top: 20px;
    padding: 14px;
    border: none;
    border-radius: 12px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    color: white;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
}

button:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
}

button:active:not(:disabled) {
    transform: translateY(0);
}

button:disabled {
    background: rgba(255, 255, 255, 0.2);
    cursor: not-allowed;
    box-shadow: none;
}

/* Preview */
.preview {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
    gap: 12px;
    margin-top: 20px;
}

.preview-item {
    position: relative;
    animation: slideIn 0.3s ease;
}

.preview img {
    width: 100%;
    height: 90px;
    object-fit: cover;
    border-radius: 12px;
    border: 2px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
}

.preview-item:hover img {
    transform: scale(1.05);
    border-color: rgba(255, 255, 255, 0.6);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

/* Progress */
.progress-container {
    width: 100%;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    margin-top: 20px;
    padding: 4px;
    display: none;
    overflow: hidden;
}

.progress-bar {
    height: 16px;
    width: 0%;
    background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
    background-size: 200% 100%;
    animation: gradientShift 2s ease infinite;
    border-radius: 8px;
    transition: width 0.3s ease;
    position: relative;
}

@keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

.progress-bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    animation: shimmer 1.5s infinite;
}

@keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

.progress-text {
    text-align: center;
    margin-top: 10px;
    font-size: 14px;
    font-weight: 600;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.file-count {
    text-align: center;
    margin-top: 10px;
    font-size: 14px;
    color: rgba(255, 255, 255, 0.8);
}
</style>
</head>

<body>

<div class="container">
    <h2>Upload Photos</h2>

    <form id="uploadForm">
        <div style="position: relative; margin-bottom:12px;">
        <input
            type="password"
            name="password"
            id="passwordInput"
            placeholder="Enter upload password"
            required
            style="
                color: #f7f7f7;
                background: #db7ac1e7;
                width:100%;
                padding:10px 40px 10px 10px;
                border-radius:8px;
                border:none;
                font-size:14px;
            "
        >
        <span
            onclick="togglePassword()"
            style="
                position:absolute;
                right:10px;
                top:50%;
                transform:translateY(-50%);
                cursor:pointer;
                font-size:16px;
                user-select:none;
            "
        >üëÅ</span>
    </div>


        <label class="upload-box" id="uploadBox">
            <div class="upload-icon">üì∏</div>
            <div class="upload-text">Click to select images</div>
            <input type="file" name="photos" multiple accept="image/*" id="fileInput">
        </label>

        <div class="file-count" id="fileCount"></div>

        <div class="preview" id="preview"></div>

        <div class="progress-container" id="progressContainer">
            <div class="progress-bar" id="progressBar"></div>
            <div class="progress-text" id="progressText">0%</div>
        </div>

        <button type="submit" id="uploadBtn">Upload</button>
    </form>
</div>

<script>
const fileInput = document.getElementById("fileInput");
const preview = document.getElementById("preview");
const form = document.getElementById("uploadForm");
const progressContainer = document.getElementById("progressContainer");
const progressBar = document.getElementById("progressBar");
const progressText = document.getElementById("progressText");
const uploadBtn = document.getElementById("uploadBtn");
const fileCount = document.getElementById("fileCount");

function togglePassword() {
    const pwd = document.getElementById("passwordInput");
    pwd.type = pwd.type === "password" ? "text" : "password";
}


/* Image Preview */
fileInput.addEventListener("change", () => {
    preview.innerHTML = "";
    const files = fileInput.files;
    
    if (files.length > 0) {
        fileCount.textContent = `${files.length} file${files.length > 1 ? 's' : ''} selected`;
        
        for (const file of files) {
            const div = document.createElement("div");
            div.className = "preview-item";
            
            const img = document.createElement("img");
            img.src = URL.createObjectURL(file);
            img.onload = () => URL.revokeObjectURL(img.src);
            
            div.appendChild(img);
            preview.appendChild(div);
        }
    } else {
        fileCount.textContent = "";
    }
});

/* Upload with Progress */
form.addEventListener("submit", e => {
    e.preventDefault();

    if (!fileInput.files.length) {
        alert("Please select files to upload");
        return;
    }

    const formData = new FormData(form);
    const xhr = new XMLHttpRequest();
    
    // Change this to match your server endpoint - currently using root "/"
    xhr.open("POST", window.location.pathname, true);
    xhr.responseType = "blob";

    progressContainer.style.display = "block";
    uploadBtn.disabled = true;
    uploadBtn.textContent = "Uploading...";

    // Track upload progress
    xhr.upload.onprogress = e => {
        if (e.lengthComputable) {
            const percent = Math.round((e.loaded / e.total) * 100);
            progressBar.style.width = percent + "%";
            progressText.textContent = `Uploading: ${percent}% (${formatBytes(e.loaded)} / ${formatBytes(e.total)})`;
        }
    };

    // When upload completes and server is processing
    xhr.upload.onload = () => {
        progressBar.style.width = "100%";
        progressText.textContent = "Processing files...";
    };

    // When server responds
    xhr.onload = () => {
            if (xhr.status === 200) {
                const blob = xhr.response;
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = "download";
                link.click();
            } else if (xhr.status === 401) {
                alert("Wrong password ‚ùå");
            } else {
                alert("Upload failed");
            }
            uploadBtn.disabled = false;
        };


            xhr.onerror = () => {
                progressText.textContent = "‚úó Network error - Check connection";
                progressBar.style.background = "linear-gradient(90deg, #ef4444, #dc2626)";
                setTimeout(resetForm, 3000);
            };

            xhr.ontimeout = () => {
                progressText.textContent = "‚úó Upload timeout - Try again";
                progressBar.style.background = "linear-gradient(90deg, #ef4444, #dc2626)";
                setTimeout(resetForm, 3000);
            };

            xhr.send(formData);
        });

// Helper function to format bytes
function formatBytes(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
}

// Helper function to reset form
function resetForm() {
    form.reset();
    preview.innerHTML = "";
    fileCount.textContent = "";
    progressContainer.style.display = "none";
    progressBar.style.width = "0%";
    progressBar.style.background = "linear-gradient(90deg, #667eea, #764ba2, #f093fb)";
    progressText.textContent = "0%";
    uploadBtn.disabled = false;
    uploadBtn.textContent = "Upload";
}
</script>

</body>
</html>